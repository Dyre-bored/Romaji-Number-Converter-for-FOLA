<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Romaji - Number Converter: FOLALALALA~</title>
  <style>
    body{
      font-family:Inter,system-ui,Arial,Helvetica,sans-serif;
      margin:0;min-height:100vh;
      display:flex;align-items:center;justify-content:center;
      background:linear-gradient(135deg,#ff4b2b,#1e3a8a,#3b82f6);
      background-size:400% 400%;
      animation:gradientBG 15s ease infinite;
      padding:18px;
      transition: background .4s,color .4s;
    }
    body.dark{
      background:linear-gradient(135deg,#0f172a,#1e293b,#334155);
    }
    @keyframes gradientBG {
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    .card{
      width:760px;max-width:100%;
      background:rgba(255,255,255,0.9);
      padding:24px;
      border-radius:16px;
      box-shadow:0 12px 40px rgba(0,0,0,0.25);
      backdrop-filter:blur(8px);
      transition: background .4s,color .4s;
    }
    body.dark .card{
      background:rgba(30,41,59,0.9);
      color:#f1f5f9;
    }
    h2{
      margin:0 0 16px;font-size:22px;
      background:linear-gradient(90deg,#ef4444,#3b82f6,#10b981);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      font-weight:800;
      text-align:center;
    }
    .row{display:flex;gap:10px;margin-top:12px;align-items:center}
    .toggleBtn{background:linear-gradient(135deg,#10b981,#059669);margin-left:auto}
    /* Tabs */
    .tabs{display:flex;gap:8px;margin-bottom:18px}
    .tabBtn{flex:1;padding:10px;border-radius:10px;border:none;background:linear-gradient(135deg,#e0e7ff,#f0f9ff);color:#1e3a8a;cursor:pointer;font-weight:600;transition:background .2s}
    .tabBtn.active{background:linear-gradient(135deg,#3b82f6,#1e40af);color:#fff;}
    body.dark .tabBtn{background:#334155;color:#f1f5f9;}
    body.dark .tabBtn.active{background:#0ea5e9;color:#000;}
    .tabContent{display:none;}
    .tabContent.active{display:block;}
    /* Inputs */
    label{display:block;margin-bottom:4px;font-weight:600;color:#374151}
    body.dark label{color:#e2e8f0}
    textarea,input{width:100%;padding:12px;border-radius:10px;border:1px solid #cbd5e1;font-size:15px;box-sizing:border-box;transition:all .2s}
    textarea{min-height:90px;resize:vertical}
    textarea:focus,input:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 2px rgba(59,130,246,0.3)}
    body.dark textarea,body.dark input{background:#1e293b;border-color:#475569;color:#f1f5f9}
    button{padding:10px 14px;border-radius:10px;border:none;background:linear-gradient(135deg,#3b82f6,#1e40af);color:white;font-weight:600;cursor:pointer;transition:transform .15s ease,box-shadow .15s[...]
    button:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,0,0,0.2)}
    .copyBtn{background:#111827;color:#fff;font-size:15px;border-radius:8px;padding:7px 10px;position:absolute;right:10px;top:10px;}
    body.dark .copyBtn{background:#0ea5e9;color:#000;}
    .result{margin-top:14px;padding:12px 40px 12px 12px;position:relative;border-radius:10px;background:linear-gradient(90deg,#dbeafe,#f0f9ff);border:1px solid #bfdbfe;font-weight:700;color:#1e3a8a}
    body.dark .result{background:#0f172a;border-color:#334155;color:#38bdf8}
    .history{margin-top:8px;background:rgba(0,0,0,0.04);padding:8px;border-radius:10px;}
    .history div{display:flex;justify-content:space-between;align-items:center;padding:6px 4px;border-bottom:1px solid rgba(255,255,255,0.06)}
    .history div:last-child{border-bottom:none}
    .history-copy{background:linear-gradient(135deg,#3b82f6,#10b981);border:none;color:white;padding:6px 10px;border-radius:8px;cursor:pointer;font-size:13px;}
    body.dark .history-copy{background:#0ea5e9;color:#000;}
    .muted{color:#6b7280;font-size:13px}
    body.dark .muted{color:#94a3b8}
    .refBox{margin-top:10px;padding:10px;border-radius:10px;background:rgba(0,0,0,0.10)}
    /* toast */
    #toast{position:fixed;right:16px;bottom:16px;min-width:220px;padding:10px 14px;border-radius:8px;background:rgba(17,24,39,0.95);color:#fff;box-shadow:0 8px 20px rgba(0,0,0,0.4);opacity:0;transform[...]
    #toast.show{opacity:1;transform:translateY(0);}
  </style>
</head>
<body>
  <div class="card">
    <div class="row">
      <h2>Romaji - Number Converter: FOLALALALA~</h2>
      <button id="toggleDark" class="toggleBtn">🌙</button>
    </div>
    <div class="tabs">
      <button class="tabBtn active" data-tab="numbers">Numbers Converter</button>
      <button class="tabBtn" data-tab="dates">Date Q&amp;A</button>
    </div>
    <!-- Numbers Tab -->
    <div id="numbers" class="tabContent active">
      <div class="row" style="margin-bottom:18px;justify-content:space-between;">
        <div style="flex:1;min-width:300px;margin-right:16px;">
          <label>Romaji input</label>
          <textarea id="romajiInput" placeholder="e.g. hachijuu kyuuman gosen nihyaku ichi"></textarea>
          <div class="row">
            <button id="convertRomaji">Romaji → Number</button>
            <button id="clearRomaji" style="background:linear-gradient(135deg,#ef4444,#b91c1c)">Clear</button>
          </div>
          <div class="result">
            <span id="romajiToNumText" class="txt">Number will appear here.</span>
            <button class="copyBtn" data-target="romajiToNumText">📋</button>
          </div>
          <div id="historyRomaji" class="history"></div>
        </div>
        <div style="flex:1;min-width:300px;">
          <label>Arabic input (0–999,999,999)</label>
          <input id="numberInput" type="number" placeholder="e.g. 895201" max="999999999" />
          <div class="row">
            <button id="convertNumber">Number → Romaji</button>
            <button id="clearNumber" style="background:linear-gradient(135deg,#ef4444,#b91c1c)">Clear</button>
          </div>
          <div class="result">
            <span id="numToRomajiText" class="txt">Romaji will appear here.</span>
            <button class="copyBtn" data-target="numToRomajiText">📋</button>
          </div>
          <div id="historyNumber" class="history"></div>
        </div>
      </div>
      <div class="muted" style="margin-top:8px">Limit: up to 9 digits (0–999,999,999). Handles concatenated romaji like <code>gosen</code>, <code>nihyaku</code>, and irregular forms <code>sanbyaku</[...]
    </div>
      
    <!-- Dates Tab -->
    <div id="dates" class="tabContent">
  <label>Choose Context Date (leave empty to use today)</label>
  <input type="date" id="contextDate" />
  <label style="margin-top:8px">Question (romaji)</label>
  <textarea id="dateQuestion" placeholder="e.g. ashita wa nannichi desu ka"></textarea>
  <div class="row">
    <button id="processDateQ">Ask</button>
    <button id="clearDateQ" style="background:linear-gradient(135deg,#ef4444,#b91c1c)">Clear</button>
  </div>
  <div class="result">
    <div id="dateAnswerText" class="txt">Answer will appear here.</div>
    <button class="copyBtn" data-target="dateAnswerText">📋</button>
  </div>
  <div id="historyDate" class="history"></div>
  <div style="margin-top:12px">
    <button id="toggleRef">📖 Show Reference</button>
  </div>
  <div id="refBox" class="refBox" style="display:none">
    <b>Days of the Week:</b><br>
    getsuyoubi (Mon), kayoubi (Tue), suiyoubi (Wed), mokuyoubi (Thu), kinyoubi (Fri), doyoubi (Sat), nichiyoubi (Sun)
    <br><br>
    <b>Days of the Month (irregular):</b><br>
    1: tsuitachi, 2: futsuka, 3: mikka, 4: yokka, 5: itsuka, 6: muika, 7: nanoka, 8: youka, 9: kokonoka, 10: tooka, 14: juuyokka, 20: hatsuka, 24: nijuuyokka
  </div>
</div>
</div>
  <div id="toast" role="status" aria-live="polite"></div>
  <script>
  document.addEventListener('DOMContentLoaded',()=>{
</div>
    
    // Utilities
    const toastEl = document.getElementById('toast');
    function showToast(msg, ms=2000){
      toastEl.textContent = msg;
      toastEl.classList.add('show');
      setTimeout(()=>{ toastEl.classList.remove('show'); }, ms);
    }

    async function safeCopy(text, sourceEl){
      try{
        if(navigator.clipboard && navigator.clipboard.writeText){
          await navigator.clipboard.writeText(text);
          showToast('COPIED TO CLIPBOARD');
          return true;
        }
      }catch(err){}
      try{
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.setAttribute('readonly','');
        ta.style.position = 'absolute';
        ta.style.left = '-9999px';
        document.body.appendChild(ta);
        ta.select();
        const ok = document.execCommand('copy');
        document.body.removeChild(ta);
        if(ok){ showToast('COPIED TO CLIPBOARD'); return true; }
      }catch(e){}
      try{
        if(sourceEl){
          const range = document.createRange();
          range.selectNodeContents(sourceEl);
          const sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(range);
          showToast('COPY FAILED — TEXT SELECTED (PRESS CTRL/CMD+C)', 3000);
          return false;
        }
      }catch(e){}
      showToast('COPY FAILED — PLEASE SELECT & COPY MANUALLY', 3000);
      return false;
    }

    // Tab switching
    // Tab switching
document.querySelectorAll('.tabBtn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.tabBtn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.tabContent').forEach(c => c.classList.remove('active'));
    const targetTab = document.getElementById(btn.dataset.tab);
    if (targetTab) {
      targetTab.classList.add('active');
    }
  });
});

    // Dark toggle
    const toggleBtn = document.getElementById('toggleDark');
    toggleBtn.addEventListener('click',()=>{
      document.body.classList.toggle('dark');
      toggleBtn.textContent=document.body.classList.contains('dark')?'☀️':'🌙';
    });

    // Reference toggle
    document.getElementById('toggleRef').addEventListener('click',()=>{
      const box=document.getElementById('refBox');
      box.style.display = box.style.display === 'none' ? 'block' : 'none';
      document.getElementById('toggleRef').textContent = box.style.display==='none' ? '📖 Show Reference' : '📖 Hide Reference';
    });

    // Copy buttons
    document.querySelectorAll('.copyBtn').forEach(btn=>{
      btn.addEventListener('click', async (e)=>{
        const targetId = btn.dataset.target;
        const targetEl = document.getElementById(targetId);
        if(!targetEl) { showToast('Nothing to copy'); return; }
        const text = targetEl.textContent.trim();
        await safeCopy(text, targetEl);
      });
    });

    // History helpers
    let historyRomaji=[], historyNumber=[], historyDate=[];
    function updateHistory(id, arr){
      const box = document.getElementById(id);
      box.innerHTML = '';
      arr.forEach(item => {
        const row = document.createElement('div');
        const span = document.createElement('span'); span.textContent = item;
        const cbtn = document.createElement('button'); cbtn.textContent='📋'; cbtn.className='history-copy'; cbtn.dataset.text = item;
        row.appendChild(span); row.appendChild(cbtn); box.appendChild(row);
      });
    }

    document.addEventListener('click',(e)=>{
      const el = e.target;
      if(el && el.classList && el.classList.contains('history-copy')){
        const txt = el.dataset.text || '';
        safeCopy(txt, null);
      }
    });

    // Romaji/Number conversion logic
    function normalizeRomaji(s){ if(!s) return ''; s = s.toLowerCase(); s = s.replace(/[ū]/g,'uu').replace(/[ō]/g,'ou').replace(/[^a-z0-9\s]/g,' '); s = s.replace(/\s+/g,' ').trim(); return s; }
    function romajiToNumber(input){
      if(!input) return NaN;
      const s = normalizeRomaji(input);
      const tokens = s.split(/\s+/);
      const UNITS = { ichi:1, i:1, ni:2, san:3, yon:4, shi:4, go:5, roku:6, nana:7, shichi:7, hachi:8, kyuu:9, kyu:9, ku:9 };
      const SMALL = { juu:10, hyaku:100, sen:1000 };
      const IRREG = { sanbyaku:300, roppyaku:600, happyaku:800, sanzen:3000, hassen:8000, issen:1000 };
      let total = 0; let section = 0; let pending = 0;
      function flushPending(){ section += pending; pending = 0; }
      for(let t of tokens){
        if(IRREG[t]){ section += IRREG[t]; continue; }
        if(UNITS[t]){ pending += UNITS[t]; continue; }
        if(SMALL[t]){ const mult = SMALL[t]; if(pending===0) pending = 1; section += pending * mult; pending = 0; continue; }
        if(t === 'man'){ flushPending(); total += (section || 1) * 10000; section = 0; pending = 0; continue; }
        if(/^\d+$/.test(t)){ pending += parseInt(t,10); continue; }
        let matched = false;
        const pieces = ['kyuuman','gosen','nihyaku','hyaku','juu','man','sen'];
        for(const p of pieces){ if(t.endsWith(p) && t.length>p.length){ const left = t.slice(0,t.length-p.length); const rest = p; const numLeft = romajiToNumber(left); if(!isNaN(numLeft)){
            if(rest==='man'){ total += (section + pending + numLeft) * 10000; section=0; pending=0; matched=true; break; }
          }
        }}
        if(matched) continue;
        return NaN;
      }
      flushPending(); total += section; return total;
    }
    function numberToRomaji(num){
      if(isNaN(num) || num===null) return '';
      num = Number(num);
      if(num===0) return 'zero';
      const units=['','ichi','ni','san','yon','go','roku','nana','hachi','kyuu'];
      const hundreds=['','hyaku','ni hyaku','sanbyaku','yon hyaku','go hyaku','roppyaku','nana hyaku','happyaku','kyuu hyaku'];
      let out = '';
      if(num >= 10000){
        const manPart = Math.floor(num/10000);
        out += numberToRomaji(manPart) + ' man';
        num %= 10000;
        if(num>0) out += ' ';
      }
      if(num>=1000){
        const t = Math.floor(num/1000);
        if(t === 1) out += 'sen';
        else out += numberToRomaji(t) + ' sen';
        num %= 1000;
        if(num>0) out += ' ';
      }
      if(num>=100){ const h=Math.floor(num/100); out += (hundreds[h] || (units[h]+' hyaku')); num%=100; if(num>0) out+=' '; }
      if(num>=10){ const j=Math.floor(num/10); if(j===1) out += 'juu'; else out += units[j] + ' juu'; num%=10; if(num>0) out += ' '; }
      if(num>0) out += units[num];
      return out.trim();
    }
    // Day helpers
    const dayNames = ['nichiyoubi','getsuyoubi','kayoubi','suiyoubi','mokuyoubi','kinyoubi','doyoubi'];
    const monthDays = {1:'tsuitachi',2:'futsuka',3:'mikka',4:'yokka',5:'itsuka',6:'muika',7:'nanoka',8:'youka',9:'kokonoka',10:'tooka',14:'juuyokka',20:'hatsuka',24:'nijuuyokka'};
    function getDayName(date){ return dayNames[date.getDay()]; }
    function getDayOfMonth(date){ const d = date.getDate(); return monthDays[d] || (numberToRomaji(d) + ' nichi'); }
    function detectCopula(q){
      if(q.includes('ja arimasen deshita')) return 'JA ARIMASEN DESHITA';
      if(q.includes('ja arimasen')) return 'JA ARIMASEN';
      if(q.includes('deshita')) return 'DESHITA';
      return 'DESU';
    }
    const relativeKeys = ['ototoi','asatte','ashita','kinou','kyou'];
    const relativeMap = { kyou:0, ashita:1, asatte:2, kinou:-1, ototoi:-2 };
    // Date Q&A wiring
    const romajiToNumText = document.getElementById('romajiToNumText');
    const numToRomajiText = document.getElementById('numToRomajiText');
    const dateAnswerText = document.getElementById('dateAnswerText');
    // Convert romaji -> number
    document.getElementById('convertRomaji').addEventListener('click',()=>{
      const input = document.getElementById('romajiInput').value.trim();
      if(!input){ romajiToNumText.textContent = 'PLEASE ENTER ROMAJI NUMBER.'; return; }
      const val = romajiToNumber(input);
      if(isNaN(val)){
        romajiToNumText.textContent = 'UNRECOGNISED ROMAJI NUMBER.';
      }else{
        const out = String(val).toUpperCase();
        romajiToNumText.textContent = out;
        historyRomaji.unshift(out); if(historyRomaji.length>5) historyRomaji.pop(); updateHistory('historyRomaji', historyRomaji);
      }
    });
    document.getElementById('clearRomaji').addEventListener('click',()=>{ document.getElementById('romajiInput').value=''; romajiToNumText.textContent='Number will appear here.'; });
    // Convert number -> romaji
    document.getElementById('convertNumber').addEventListener('click',()=>{
      const raw = document.getElementById('numberInput').value.trim();
      const num = parseInt(raw,10);
      if(isNaN(num)){ numToRomajiText.textContent='PLEASE ENTER A VALID NUMBER.'; return; }
      const out = numberToRomaji(num).toUpperCase();
      numToRomajiText.textContent = out;
      historyNumber.unshift(out); if(historyNumber.length>5) historyNumber.pop(); updateHistory('historyNumber', historyNumber);
    });
    document.getElementById('clearNumber').addEventListener('click',()=>{ document.getElementById('numberInput').value=''; numToRomajiText.textContent='Romaji will appear here.'; });
    
    // Date Q&A processing (APPLIED PATCH)
    document.getElementById('processDateQ').addEventListener('click',()=>{
      const qRaw = document.getElementById('dateQuestion').value.trim();
      const q = (qRaw||'').toLowerCase();
      let dateVal = document.getElementById('contextDate').value;
      if(!dateVal) { 
        const d = new Date(); dateVal = d.toISOString().split('T')[0];
      }
      if(!q){ dateAnswerText.textContent = 'PLEASE PROVIDE A QUESTION.'; return; }
      const baseDate = new Date(dateVal);

      // Relative day
      const relativeKeys = ['ototoi','asatte','ashita','kinou','kyou'];
      const relativeMap = { kyou:0, ashita:1, asatte:2, kinou:-1, ototoi:-2 };
      let foundKey = relativeKeys.find(k=>q.includes(k)) || 'kyou';
      const offset = relativeMap[foundKey];
      const target = new Date(baseDate);
      target.setDate(baseDate.getDate() + offset);

      // Copula detection
      function detectCopula(q){
        if(q.includes('ja arimasen deshita')) return 'JA ARIMASEN DESHITA';
        if(q.includes('ja arimasen')) return 'JA ARIMASEN';
        if(q.includes('deshita')) return 'DESHITA';
        return 'DESU';
      }
      const copula = detectCopula(q);

      // Asked type detection
      const askDateGeneric = q.includes('nannichi') || q.includes('nichi');
      const askWeekdayGeneric = q.includes('nanyoubi') || q.includes('youbi');

      // Check for explicit irregular date word (e.g. "tsuitachi")
      const monthDays = {1:'tsuitachi',2:'futsuka',3:'mikka',4:'yokka',5:'itsuka',6:'muika',7:'nanoka',8:'youka',9:'kokonoka',10:'tooka',14:'juuyokka',20:'hatsuka',24:'nijuuyokka'};
      let explicitNumber = null;
      for(const [num, word] of Object.entries(monthDays)){
        if(q.includes(word)){ explicitNumber = parseInt(num,10); break; }
      }

      // Result determination
      let resultText = '';
      const dayNames = ['nichiyoubi','getsuyoubi','kayoubi','suiyoubi','mokuyoubi','kinyoubi','doyoubi'];
      if(explicitNumber !== null){
        const actualNum = target.getDate();
        if(explicitNumber === actualNum){
          resultText = `${foundKey.toUpperCase()} WA ${monthDays[actualNum].toUpperCase()} ${copula}`;
        } else {
          resultText = `${foundKey.toUpperCase()} WA ${monthDays[actualNum].toUpperCase()} ${copula}`;
        }
      } else if(askDateGeneric && askWeekdayGeneric){
        resultText = `${foundKey.toUpperCase()} WA ${(monthDays[target.getDate()] || target.getDate()).toString().toUpperCase()}, ${dayNames[target.getDay()].toUpperCase()} ${copula}`;
      } else if(askDateGeneric){
        resultText = `${foundKey.toUpperCase()} WA ${(monthDays[target.getDate()] || target.getDate()).toString().toUpperCase()} ${copula}`;
      } else if(askWeekdayGeneric){
        resultText = `${foundKey.toUpperCase()} WA ${dayNames[target.getDay()].toUpperCase()} ${copula}`;
      } else {
        resultText = 'SUMIMASEN, SONO SHITSUMON WA MADA WAKARIMASEN.';
      }

      // Show context above answer
      dateAnswerText.innerHTML = '';
      const contextEl = document.createElement('div');
      contextEl.style.fontSize='12px';
      contextEl.style.opacity='0.7';
      contextEl.style.marginBottom='4px';
      contextEl.textContent = `Context: ${baseDate.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})}`;
      dateAnswerText.appendChild(contextEl);

      const answerSpan = document.createElement('span');
      answerSpan.textContent = resultText.toUpperCase();
      dateAnswerText.appendChild(answerSpan);

      // History
      historyDate.unshift(resultText.toUpperCase());
      if(historyDate.length>5) historyDate.pop();
      updateHistory('historyDate', historyDate);
    });
    document.getElementById('clearDateQ').addEventListener('click',()=>{ document.getElementById('dateQuestion').value=''; dateAnswerText.textContent='Answer will appear here.'; });
  });
  </script>
</body>
</html>
